<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Display Item ID from Cache</title>
    <!-- Include the Firebase JavaScript SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-database.js"></script>
  </head>
  <body>
    <!-- -----------------------------------------------Header------------------------------------- -->

  

    <section class="packages" id="services">
      <div class="heading">
        <h1>wedding</h1>
      </div>
    </section>

    <!-- packages -->

    <div id="menu"></div>
    <div id="itemIdDisplay"></div>
   

    <!--------------------------------------------------------- Footer ------------------------------------------->

  
    <!-- backend -->
    <script src="firebase.js"></script>
    <script>
// Get a reference to the database
// Get a reference to the database
var database = firebase.database();
var menuRef = database.ref("wedding");

// Check if menu items are already loaded
var menuItemsLoaded = false;

menuRef.on("value", function(snapshot) {
    var menuData = snapshot.val();

    // Retrieve itemId from localStorage
    var itemId = localStorage.getItem("itemName");

    // Display menu data on the web page
    var menuContainer = document.getElementById("menu");
    menuContainer.innerHTML = "";

    for (var key in menuData) {
        if (menuData.hasOwnProperty(key)) {
            var menuItem = menuData[key];
            if (menuItem.name === itemId) {
                // Create menu item element
                var menuItemElement = document.createElement("div");
                menuItemElement.innerHTML = `
                <div class="packagesBox">
                    <!-- Loop through each image URL in the menuItem.images array -->
${menuItem.images.map(image => `
    <div class="image">
        <img src="${image}" alt="${menuItem.name}" class="menu-image-visa">
        <div class="image-overlay"></div>
        <div class="image-overlay-gradient"></div>
    </div>
`).join('')}

                    <div class="buttons">
                        <!-- Check if menuItem.button1 is defined before rendering the button -->
${menuItem.button1 ? `<button class="price-button" data-price="${menuItem.button1Price}">${menuItem.button1}</button>` : ''}

<!-- Check if menuItem.button2 is defined before rendering the button -->
${menuItem.button2 ? `<button class="price-button" data-price="${menuItem.button2Price}">${menuItem.button2}</button>` : ''}

<!-- Check if menuItem.button3 is defined before rendering the button -->
${menuItem.button3 ? `<button class="price-button" data-price="${menuItem.button3Price}">${menuItem.button3}</button>` : ''}

<!-- Check if menuItem.button4 is defined before rendering the button -->
${menuItem.button4 ? `<button class="price-button" data-price="${menuItem.button4Price}">${menuItem.button4}</button>` : ''}

<!-- Check if menuItem.button5 is defined before rendering the button -->
${menuItem.button5 ? `<button class="price-button" data-price="${menuItem.button5Price}">${menuItem.button5}</button>` : ''}

<!-- Check if menuItem.button6 is defined before rendering the button -->
${menuItem.button6 ? `<button class="price-button" data-price="${menuItem.button6Price}">${menuItem.button6}</button>` : ''}

<!-- Check if menuItem.button7 is defined before rendering the button -->
${menuItem.button7 ? `<button class="price-button" data-price="${menuItem.button7Price}">${menuItem.button7}</button>` : ''}

<!-- Check if menuItem.button8 is defined before rendering the button -->
${menuItem.button8 ? `<button class="price-button" data-price="${menuItem.button8Price}">${menuItem.button8}</button>` : ''}

<!-- Check if menuItem.button9 is defined before rendering the button -->
${menuItem.button9 ? `<button class="price-button" data-price="${menuItem.button9Price}">${menuItem.button9}</button>` : ''}
${menuItem.button10 ? `<button class="price-button" data-price="${menuItem.button10Price}">${menuItem.button10}</button>` : ''}
${menuItem.button11 ? `<button class="price-button" data-price="${menuItem.button11Price}">${menuItem.button11}</button>` : ''}
${menuItem.button12 ? `<button class="price-button" data-price="${menuItem.button12Price}">${menuItem.button12}</button>` : ''}
${menuItem.button13 ? `<button class="price-button" data-price="${menuItem.button13Price}">${menuItem.button13}</button>` : ''}
${menuItem.button14 ? `<button class="price-button" data-price="${menuItem.button14Price}">${menuItem.button14}</button>` : ''}
${menuItem.button15 ? `<button class="price-button" data-price="${menuItem.button15Price}">${menuItem.button15}</button>` : ''}
${menuItem.button16 ? `<button class="price-button" data-price="${menuItem.button16Price}">${menuItem.button16}</button>` : ''}
${menuItem.button17 ? `<button class="price-button" data-price="${menuItem.button17Price}">${menuItem.button17}</button>` : ''}

                        <button class="add-to-cart-button" data-name="${menuItem.name}" data-image="${menuItem.image}" data-price="${menuItem.price}">Add to Cart</button>
                    </div>
                    <section class="packages-box-container">
                        <div class="content">
                            <div class="package-details">    
                                <div class="package-name-visa">    
                                    <h2>${menuItem.name}</h2>
                                </div> 
                            </div>
                            <div class="package-prices">
                                <div class="package-price" id="current-price">        
                                    <h4>Rs ${menuItem.button1Price}</h4>
                                </div>
                            </div>
                            <div class="package-des" id="des">
                                <div class="heading">
                                    <span class="package-des-title">Package Description</span>
                                    <div class="hr">
                                        <hr class="footer-hr des-hr" />
                                    </div>
                                </div>   
                                <div class="package-des1">
                                    <p class="des-1">${menuItem.description}</p>
                                </div>
                                <div class="package-des2">
                                    <p class="des-2">${menuItem.descriptionnext}</p>
                                </div> 
                            </div>
                        </div>
                    </section>      
                </div>`;

                // Append menu item element to menu container
                menuContainer.appendChild(menuItemElement);
                
// Add event listeners to Price buttons
var priceButtons = menuItemElement.querySelectorAll(".price-button");
priceButtons.forEach(function(priceButton, index) {
    priceButton.addEventListener("click", function() {
        // Update current price display
        var currentPrice = menuItemElement.querySelector("#current-price h4");
        currentPrice.textContent = "Rs " + priceButton.getAttribute("data-price");

        // Capture the current button name
        var currentButtonName = priceButton.textContent;
        console.log("Current button name:", currentButtonName);

        // Store the current button name in localStorage
        localStorage.setItem("currentButtonName", currentButtonName);
    });

    // Simulate click event on button 1 by default
    if (index === 0) {
        priceButton.click();
    }
});


// Add event listener to Add to Cart button
var addToCartButton = menuItemElement.querySelector(".add-to-cart-button");
addToCartButton.addEventListener("click", function() {
    var itemName = addToCartButton.getAttribute("data-name");
    var itemImages = menuItem.images; // Retrieve array of images
    var randomImageIndex = Math.floor(Math.random() * itemImages.length); // Generate a random index
    var randomImage = itemImages[randomImageIndex]; // Get a random image from the array
    var itemPrice = menuItemElement.querySelector("#current-price h4").textContent.replace("Rs ", "");
    
    // Retrieve the current button name from localStorage
    var currentButtonName = localStorage.getItem("currentButtonName");
    console.log("Retrieved current button name:", currentButtonName);

    // Retrieve existing cart items from localStorage or initialize an empty array
    var cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

    // Check if the item is already in the cart (including price and button name)
    var existingItem = cartItems.find(function(item) {
        return item.name === itemName && item.price === itemPrice && item.buttonName === currentButtonName;
    });

    if (!existingItem) {
        // Item not in cart, add it
        cartItems.push({
            name: itemName,
            image: randomImage, // Use the random image
            price: itemPrice,
            buttonName: currentButtonName, // Store the current button name
            quantity: 1 // Initialize quantity to 1
        });
    } else {
        // Item already in cart, increment quantity
        existingItem.quantity = (existingItem.quantity || 1) + 1;
    }

    // Save updated cart items to localStorage
    localStorage.setItem("cartItems", JSON.stringify(cartItems));

    // Provide feedback to the user
    alert("Item added to cart!");
});



            }
        }
    }
});



</script>
    
  </body>
</html>