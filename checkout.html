<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="checkout.css" />
  </head>
  <body>
    <!-- -----------------------------------------Header--------------------------------------- -->
    <div class="header">
      <div class="header-container">
        <button onclick="openNav()" class="navbar-toggler" type="button">
          <i class="ri-menu-line sidebar-btn"></i>
        </button>
        <div class="logo">
          <a href="index.html"><img src="images/logo.jpg" alt="logo" /></a>
        </div>
        <div class="navbar">
          <a href="index.html">Home</a>
          <a href="#about">About</a>
          <div class="dropdown">
            <button class="dropbtn">
              Product Categories
              <i class="ri-arrow-down-s-line"></i>
            </button>
            <div class="dropdown-content">
              <a href="eid.html">Eid Collection</a>
              <a href="wedding.html">Wedding Wear</a>
              <a href="formal.html">Formal Wear</a>
              <a href="bags.html">Mini Bags / Potlies</a>
            </div>
          </div>
          <a href="contact.html">Contact Us</a>
        </div>
        <div class="addtocart">
          <a href="cart.html"><i class="ri-shopping-cart-2-fill"></i></a>
        </div>
      </div>
      <!-- open sidebar -->
      <aside class="sidepanel" id="mysidepanel">
        <div class="sidebar flex">
          <button
            onclick="closeNav()"
            type="button"
            class="closebtn btn_hover1"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <!-- -----------side menus--------------- -->
        <ul>
          <li><a href="index.html" class="nav-link active">Home</a></li>
          <li><a href="#about" class="nav-link">About</a></li>
          <li><a href="eid.html" class="nav-link">Eid Collection</a></li>
          <li><a href="wedding.html" class="nav-link">Wedding Wear</a></li>
          <li><a href="formal.html" class="nav-link">Formal Wear</a></li>
          <li>
            <a href="bags.html" class="nav-link">Mini Bags / Potlies</a>
          </li>
          <li>
            <a href="contact.html" class="nav-link">Contact Us</a>
          </li>
        </ul>
      </aside>
    </div>

    <!-- ------------------------------------------checkout---------------------------------------- -->

    <section class="checkout-container">
      <div class="content">
        <h1>Checkout</h1>
      </div>

      <div class="form-container">
        <div class="form">
          <form class="colorful-form" id="order-form">
            <div class="form-group">
              <label class="form-label" for="name">Full Name:</label>
              <input
                required
                placeholder="Enter your name"
                class="form-input"
                name="name"
                id="name"
                type="text"
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="email">Contact:</label>
              <input
                required
                placeholder="Enter your email"
                class="form-input"
                name="contact"
                id="contact"
                type="number"
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="message">Full Address:</label>
              <textarea
                required
                placeholder="Enter your Address"
                class="form-input"
                name="address"
                id="address"
              ></textarea>
            </div>
            <button class="form-button" type="submit">Place Order</button>
          </form>
        </div>

        <div id="cart-items" class="cart-items"></div>

        <div class="bank-details">
          <p>
            <strong>Account title</strong> Ifra shahid
            <br />
            <strong>Iban number</strong> PK84MEZN0002570109165921
            <br />
            <strong>Account number</strong> 02570109165921
            <br />
            <strong>Bank name</strong> Meezan Bank Branch
            <br />
            <br />
            <strong
              >*Please share the receipt with us via WhatsApp at +92-320-8106090
              once the payment is made* *For overseas customers kindly contact
              us for shipping costs before placing an order* *WhatsApp at
              +92-320-8106090 for size and color customization*</strong
            >
            <br />
          </p>
        </div>
      </div>
    </section>

    <!-- -------------------------------------------------footer-------------------------------------- -->
    <div class="footer-container">
      <section class="footer">
        <div class="box-container">
          <div class="box">
            <a href="#"
              ><img class="logo footer-logo" src="images/logo new.png"
            /></a>
            <p class="footer-line">Elevate your style, one stitch at a time.</p>
            <div class="socials">
              <a
                href="https://www.facebook.com/littletoescouturehouse?mibextid=LQQJ4d"
                ><i class="ri-facebook-line"></i
              ></a>
              <a
                href="https://www.instagram.com/littletoescouturehouse?igsh=MTdvM2RlaWlhOWMzMQ=="
                ><i class="ri-instagram-line"></i
              ></a>
              <a href="https://wa.me/+923208106090"
                ><i class="ri-whatsapp-fill"></i
              ></a>
              <a href="mailto:Ifrashahid94@gmail.com"
                ><i class="ri-mail-line"></i
              ></a>
            </div>
          </div>

          <div class="box">
            <h3>Quick Links</h3>
            <a href="#home" class="links"
              ><i class="fa-solid fa-arrow-right"></i>Home</a
            >
            <a href="#sale" class="links"
              ><i class="fa-solid fa-arrow-right"></i>Sales</a
            >
            <a href="#categories" class="links"
              ><i class="fa-solid fa-arrow-right"></i>Categories</a
            >
            <a href="#about" class="links"
              ><i class="fa-solid fa-arrow-right"></i>About us</a
            >
            <a href="#products" class="links"
              ><i class="fa-solid fa-arrow-right"></i>Products</a
            >
          </div>

          <div class="box contact-info">
            <h3>Contact Info</h3>
            <a href="tel:+923208106090" class="phone-number"
              ><i class="fa-solid fa-phone"></i>+92-320-8106090</a
            >
            <p><i class="fa-solid fa-envelope"></i>Ifrashahid94@gmail.com</p>
            <p><i class="fa-solid fa-clock"></i>24/7</p>
          </div>

          <div class="box">
            <h3>NewsLetter</h3>
            <p>Subscribe For latest Updates</p>
            <form action="" id="newsletter">
              <input
                type="email"
                id="email"
                name=""
                placeholder="Drop your email"
                class="newsletter"
              />
              <input type="submit" value="subscribe" class="btn-1" />
            </form>
          </div>
        </div>
      </section>
    </div>

    <div class="copywrite">
      <span>Littletoescouturehouse</span> | all rights reserved
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-database.js"></script>
    <script src="firebase.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Retrieve cart items from localStorage
        var cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

        // Display cart items on the page
        var cartItemsContainer = document.getElementById("cart-items");
        if (cartItems.length === 0) {
          cartItemsContainer.innerHTML = "<p>Your cart is empty ðŸ˜ž.</p>";
        } else {
          var totalAmount = 0;

          cartItems.forEach(function (item) {
            var itemElement = document.createElement("div");
            itemElement.innerHTML = `
                        <div class="checkout-details">
                            <p>Name: ${item.name}</p>
                            <p>Price: Rs ${item.price}</p>
                            <p>Quantity: ${item.quantity}</p>
                            <p>Size: ${item.buttonName}</p>
                            <hr>
                        </div>`;
            cartItemsContainer.appendChild(itemElement);

            // Calculate total amount
            totalAmount += parseInt(item.price) * parseInt(item.quantity);
          });

          // Display total amount
          cartItemsContainer.innerHTML += `<h3 class="checkout-total">Total: Rs ${totalAmount}</h3>`;

          // Add event listeners to Remove buttons
          var removeButtons = document.querySelectorAll(".remove-item-button");
          removeButtons.forEach(function (button) {
            button.addEventListener("click", function () {
              var itemName = button.getAttribute("data-name");
              var itemPrice = button.getAttribute("data-price");

              // Retrieve cart items from localStorage
              var cartItems =
                JSON.parse(localStorage.getItem("cartItems")) || [];

              // Find index of item to remove
              var index = cartItems.findIndex(function (item) {
                return item.name === itemName && item.price === itemPrice;
              });

              // Decrease quantity by 1 or remove item if quantity is 1
              if (index !== -1) {
                if (cartItems[index].quantity > 1) {
                  cartItems[index].quantity--;
                } else {
                  cartItems.splice(index, 1);
                }
                // Update cart items in localStorage
                localStorage.setItem("cartItems", JSON.stringify(cartItems));
                // Refresh cart display
                location.reload();
              }
            });
          });
        }
      });

      // Add event listener to form submission
      document
        .getElementById("order-form")
        .addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent default form submission

          // Retrieve form data
          var formData = new FormData(event.target);
          var formDataObject = {};
          formData.forEach(function (value, key) {
            formDataObject[key] = value;
          });

          // Retrieve cart items from localStorage
          var cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

          // Save form data and cart items to Firebase Realtime Database
          var database = firebase.database();
          var ordersRef = database.ref("orders");
          var newOrderRef = ordersRef.push();
          newOrderRef
            .set({
              name: formDataObject.name,
              contact: formDataObject.contact,
              address: formDataObject.address,
              cartItems: cartItems,
            })
            .then(function () {
              // Redirect to pay.html
              window.location.href = "pay.html";
            })
            .catch(function (error) {
              console.error("Error saving order:", error);
              alert(
                "Error occurred while placing the order. Please try again later."
              );
            });
        });
    </script>
    <script src="script.js"></script>
  </body>
</html>
